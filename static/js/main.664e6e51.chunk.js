(this["webpackJsonplfs-errors-dashboard"]=this["webpackJsonplfs-errors-dashboard"]||[]).push([[0],{155:function(e,n,t){e.exports={mainContainer:"Dashboard_mainContainer__AvxgX"}},156:function(e,n,t){e.exports=t.p+"static/media/lfs_logo.aaf7ea0d.png"},162:function(e,n,t){e.exports={container:"LoginBanner_container__kdXDu"}},179:function(e,n,t){e.exports=t(340)},184:function(e,n,t){},340:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),i=t(4),o=t.n(i),c=(t(184),t(185),t(89)),s=t(44),u=t(25),l=function(){throw Error("gauth is not initialized yet")},m={initialized:!1,isSignedIn:!1,profile:{},tokens:{},error:void 0,signIn:l,signOut:l},d={initialized:!1,client:void 0,error:void 0},f={active:!1,max:void 0,current:void 0,message:"Loading..."},p=Object(s.combineReducers)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,n=arguments.length>1?arguments[1]:void 0,t=n.signIn,r=n.signOut,a=n.error,i=n.profile,o=n.tokens;switch(n.type){case"AUTH_INIT":return Object(u.a)({},e,{initialized:!0,signIn:t,signOut:r});case"AUTH_INIT_ERROR":return Object(u.a)({},m,{error:a});case"AUTH_SIGN_IN":return Object(u.a)({},e,{isSignedIn:!0,profile:i,tokens:o});case"AUTH_SIGN_OUT":return Object(u.a)({},e,{isSignedIn:!1,profile:{},tokens:{}});default:return e}},mail:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,n=arguments.length>1?arguments[1]:void 0,t=n.client,r=n.error;switch(n.type){case"MAIL_INIT":return Object(u.a)({},e,{client:t,initialized:!0});case"MAIL_INIT_ERROR":return Object(u.a)({},d,{error:r});default:return e}},progress:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,n=arguments.length>1?arguments[1]:void 0,t=n.type,r=n.message,a=n.max,i=n.current;switch(t){case"PROGRESS_ACTIVATE":return Object(u.a)({},e,{active:!0,max:a,current:i,message:r});case"PROGRESS_INCREMENT":return Object(u.a)({},e,{current:e.current+1});case"PROGRESS_DEACTIVATE":return Object(u.a)({},e,{active:!1});default:return e}}}),g=t(13),v=t.n(g),h=t(23),I=t(68),b=t(155),E=t.n(b),_=t(11),k=t.n(_),O=function(e,n){var t=setInterval((function(){var r=e();r&&(clearInterval(t),n(r))}),100)},x=function(e){var n=e.currentUser.get();if(void 0===n)return{isSignedIn:!1,profile:{},tokens:{}};var t=n.getBasicProfile(),r=n.getAuthResponse();return{isSignedIn:n.isSignedIn(),profile:void 0===t?{}:{googleId:t.getId(),imageUrl:t.getImageUrl(),email:t.getEmail(),name:t.getName(),givenName:t.getGivenName(),familyName:t.getFamilyName()},tokens:void 0===r?{}:{idToken:r.id_token,accessToken:r.access_token}}},S=function(e){var n=e.clientId,t=e.hostedDomain,a=e.scope,i=e.onInitialized,o=e.onInitializationError,c=e.onSignedIn,s=e.onSignedOut;Object(r.useEffect)((function(){!function(e){var n=e.clientId,t=e.hostedDomain,r=e.scope,a=e.onInit,i=e.onError,o={client_id:n,cookie_policy:"single_host_origin",hosted_domain:t,fetch_basic_profile:!0,ux_mode:"popup",scope:r};O((function(){return window.gapi}),(function(e){e.load("auth2",(function(){return e.auth2.init(o).then(a,i)}),i)}))}({clientId:n,hostedDomain:t,scope:a,onInit:function(e){e.isSignedIn.listen((function(n){n?c(x(e)):s()}));i({signIn:function(){return e.signIn().then(k.a.noop,(function(e){return console.error("Got error:",e)}))},signOut:function(){return e.signOut().then(e.disconnect())}});var n=x(e);n.isSignedIn&&c(n)},onError:function(e){o(e)}})}),[])},w=t(56),y=t.n(w),j=t(344),N=t(345),C=t(156),T=t.n(C),A=t(70),R=t.n(A),z=t(341),B=function(e){var n=e.disabled,t=e.name,r=e.userPickLink,i=e.onSignOutClicked;return a.a.createElement("div",{className:R.a.container},a.a.createElement("div",{className:R.a.avatarContainer},a.a.createElement(z.a,{size:48,icon:"user",src:r})),a.a.createElement("div",{className:R.a.nameAndButtonContainer},a.a.createElement("div",{className:R.a.userNameSpan},t),n?a.a.createElement("span",null,"Sign out"):a.a.createElement("a",{href:"",onClick:function(e){e.preventDefault(),i()}},"Sign out")))},L=t(26),M=t.n(L),D=function(e){var n=e.name,t=e.imageUrl,r=e.isSignedIn,i=e.signOut;return a.a.createElement("header",{className:y.a.header},a.a.createElement(j.a,null,a.a.createElement(N.a,{span:12,offset:2},a.a.createElement("div",{className:y.a.logoContainer},a.a.createElement("img",{src:T.a,width:"48px",alt:"Logo",className:y.a.logo}),a.a.createElement("div",{className:y.a.titleContainer},a.a.createElement("h1",{className:y.a.logoTitle},"LFS Errors Dashboard"),"\xa0\xa0",a.a.createElement("a",{href:"https://github.com/burkov/lfs-errors-dashboard/releases/tag/v0.4.0",target:"_blank"},"v0.4.0"),"\xa0released ",M()("2020-02-24T17:44:37+03:00").fromNow()))),a.a.createElement(N.a,{offset:4,span:4},r&&a.a.createElement(B,{name:n,userPickLink:t,onSignOutClicked:i}))))},P=t(159),U=t(343),H=t(346),G=t(90),F=t.n(G),K=function(e){var n=e.current,t=e.max,r=e.message,i=e.errors,o=void 0!==n&&void 0!==t,c=o&&100*parseInt(n)/parseInt(t);return a.a.createElement("div",{className:F.a.container},a.a.createElement(P.a,{size:"large"}),a.a.createElement("p",{className:F.a.message},r),o&&a.a.createElement(U.a,{percent:c,status:"active"}),i.map((function(e){return a.a.createElement(H.a,{message:e,type:"error",className:F.a.errorAlert})})))},Y=t(162),q=t.n(Y),V=t(91),X=function(e){var n=e.onSignInClicked,t=e.disabled;return a.a.createElement("div",{className:q.a.container},a.a.createElement("p",null,"To start using the app sign in to your ",a.a.createElement("strong",null,"@jetbrains.com")," account"),a.a.createElement(V.a,{disabled:t,onClick:n},"Sign in"))},J=t(55),Q=t(174),W=t(342),$=t(57),Z=t.n($),ee=t(2),ne=t.n(ee),te=function(e){return{title:"Subject",dataIndex:"subject",key:"subject",render:function(n,t){var r=t.actions.open,i=t.id;return a.a.createElement(a.a.Fragment,null,a.a.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer"},a.a.createElement(V.a,{icon:"link",type:"link"})),"\xa0",a.a.createElement("span",{className:ne()(Object(J.a)({},Z.a.unread,e&&!e.has(i)))},n.slice(0,160)))}}},re=function(e){var n=e.title,t=e.readIds;return{title:n,dataIndex:"date",key:"date",render:function(e,n){var r=n.id,i=M()(e);return a.a.createElement(Q.a,{title:i.format(),placement:"bottom"},a.a.createElement("span",{className:ne()(Object(J.a)({},Z.a.unread,t&&!t.has(r)))},i.fromNow()))}}},ae=function(e){var n=e.others;if(k.a.isEmpty(n))return!1;var t=[re({title:"Date"}),te()];return a.a.createElement(W.a,{showHeader:!1,rowKey:"id",dataSource:n,columns:t,size:"small",pagination:{pageSize:10,position:"bottom",hideOnSinglePage:!0}})},ie=function(e){var n=e.messages,t=e.onMarkReadClicked,i=e.onMarkUnreadClicked,o=e.readIds,c=Object(r.useState)([]),s=Object(I.a)(c,2),u=s[0],l={onChange:s[1]},m=Object(r.useMemo)((function(){return[re({title:"Last",readIds:o}),{title:"# of similar",dataIndex:"number",key:"number",render:function(e,n){var t=n.id;return a.a.createElement("span",{className:ne()(Object(J.a)({},Z.a.unread,!o.has(t)))},e)}},te(o)]}),[o]);return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:Z.a.buttonsContainer},a.a.createElement(V.a,{icon:"check",onClick:function(){return t(u)}},"Mark read"),"\xa0",a.a.createElement(V.a,{icon:"close",onClick:function(){return i(u)}},"Mark un-read"),a.a.createElement("div",{className:Z.a.selectionCount},u.length," threads selected")),a.a.createElement(W.a,{rowKey:"id",dataSource:n,columns:m,size:"small",pagination:!1,expandedRowRender:ae,rowSelection:l}))},oe=function(e){var n=e.apiKey,t=e.onInitialized,a=e.onInitializationError;Object(r.useEffect)((function(){!function(e){var n=e.apiKey,t=e.onInit,r=e.onError,a={apiKey:n,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"]};O((function(){return window.gapi}),(function(e){e.load("client",(function(){return e.client.init(a).then(t,r)}),r)}))}({apiKey:n,onInit:function(){t(window.gapi.client)},onError:a})}),[])},ce=function(e,n){var t=e.newBatch();return n.forEach((function(n){t.add(e.request({path:"gmail/v1/users/me/messages/".concat(n),params:{format:"metadata",metadataHeaders:["Subject","Date"]}}))})),new Promise((function(e,n){setTimeout((function(){t.then((function(n){var t=n.result;e(k.a.map(k.a.values(t),(function(e){return k.a.get(e,"result")})))}),(function(e){return n(e)}))}),300)}))},se=function(){var e=Object(h.a)(v.a.mark((function e(n,t){var r,a,i,o,c,s,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k.a.isEmpty(t)){e.next=2;break}return e.abrupt("return",[]);case 2:r=[],a=!0,i=!1,o=void 0,e.prev=6,c=k.a.chunk(t,100)[Symbol.iterator]();case 8:if(a=(s=c.next()).done){e.next=18;break}return u=s.value,e.t0=r,e.next=13,ce(n,u);case 13:e.t1=e.sent,r=e.t0.concat.call(e.t0,e.t1);case 15:a=!0,e.next=8;break;case 18:e.next=24;break;case 20:e.prev=20,e.t2=e.catch(6),i=!0,o=e.t2;case 24:e.prev=24,e.prev=25,a||null==c.return||c.return();case 27:if(e.prev=27,!i){e.next=30;break}throw o;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.abrupt("return",r);case 33:case"end":return e.stop()}}),e,null,[[6,20,24,32],[25,,27,31]])})));return function(n,t){return e.apply(this,arguments)}}(),ue=function(){var e=Object(h.a)(v.a.mark((function e(n){var t,r,a,i,o,c,s,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=void 0,r=[],a=M()().subtract(30,"day").format("YYYY/MM/DD"),i="(<jetprofile-prod-lfs-notifications.jetbrains.com>)";case 4:return e.next=6,n.gmail.users.messages.list({userId:"me",q:"list:".concat(i," after:").concat(a),pageToken:t});case 6:o=e.sent,c=o.result,s=c.messages,u=c.nextPageToken,r=r.concat(k.a.map(s,(function(e){return e.id}))),t=u;case 12:if(!k.a.isNil(t)){e.next=4;break}case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=t(168),me=t(117),de=t.n(me),fe=t(46),pe=de.a.createInstance({name:"led-main"}),ge=de.a.createInstance({name:"led-mails"}),ve=function(){var e=Object(h.a)(v.a.mark((function e(n){var t,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be();case 2:return t=e.sent,r=n(t),e.next=6,pe.setItem("read-ids",r.toArray());case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),he=function(e){return ve((function(n){return n.union(e)}))},Ie=function(e){return ve((function(n){return n.subtract(e)}))},be=function(){var e=Object(h.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=fe.a,e.next=3,pe.getItem("read-ids");case 3:if(e.t1=e.sent,e.t1){e.next=6;break}e.t1=[];case 6:return e.t2=e.t1,e.abrupt("return",(0,e.t0)(e.t2));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ee=function(){var e=Object(h.a)(v.a.mark((function e(n){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=fe.a,e.next=3,ge.keys();case 3:return e.t1=e.sent,t=(0,e.t0)(e.t1),e.abrupt("return",k.a.filter(n,(function(e){return!t.has(e)})));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_e=function(e){return e.replace(/^(jetprofile-prod RT error: )/,"")},ke=function(){var e=Object(h.a)(v.a.mark((function e(n){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.map((function(e){try{var n=e.id,t=e.payload.headers,r=k.a.find(t,(function(e){return"date"===e.name.toLowerCase()})).value,a=k.a.find(t,(function(e){return"subject"===e.name.toLowerCase()})).value;return ge.setItem(n,{date:r,subject:_e(a)})}catch(i){return void console.error("failed to parse or save message",e,i)}})),e.next=3,Promise.all(t);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Oe=function(){var e=Object(h.a)(v.a.mark((function e(n){var t,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map(function(){var e=Object(h.a)(v.a.mark((function e(n){var t,r,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge.getItem(n);case 2:if(null!==(t=e.sent)){e.next=6;break}return console.error("failed to fetch mail with id: ".concat(n)),e.abrupt("return",void 0);case 6:return r=t.date,a=Object(le.a)(t,["date"]),e.abrupt("return",Object(u.a)({},a,{id:n,date:r,timestamp:M()(r).unix(),actions:{open:"https://mail.google.com/mail/u/0/#inbox/".concat(n)}}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 2:return t=e.sent,r=k.a.values(k.a.groupBy(k.a.compact(t),(function(e){return e.subject.slice(0,20)}))).map((function(e){e.forEach((function(e){e.timestamp=M()(e.date).unix()}));var n=k.a.maxBy(e,"timestamp"),t=n.id;return Object(u.a)({},n,{number:e.length,others:k.a.reverse(k.a.sortBy(k.a.remove(e,(function(e){return e.id!==t})),"timestamp"))})})),e.abrupt("return",k.a.reverse(k.a.sortBy(r,"timestamp")));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),xe=(window.location.host.includes("localhost"),{onAuthInit:function(e){return{type:"AUTH_INIT",signIn:e.signIn,signOut:e.signOut}},onAuthInitError:function(e){return{type:"AUTH_INIT_ERROR",error:e}},onSignedIn:function(e){return{type:"AUTH_SIGN_IN",profile:e.profile,tokens:e.tokens}},onSignedOut:function(){return{type:"AUTH_SIGN_OUT"}},onMailInit:function(e){return{type:"MAIL_INIT",client:e}},onMailInitError:function(e){return{type:"MAIL_INIT_ERROR",error:e}},activateProgress:function(e){return{type:"PROGRESS_ACTIVATE",message:e.message,current:e.current,max:e.max}},incrementProgress:function(){return{type:"PROGRESS_INCREMENT"}},deactivateProgress:function(){return{type:"PROGRESS_DEACTIVATE"}}}),Se=Object(c.b)((function(e){var n=e.auth,t=n.initialized,r=n.isSignedIn,a=n.signIn,i=n.signOut,o=n.profile,c=n.error,s=e.mail,u=s.initialized,l=s.client,m=s.error,d=e.progress,f=d.active,p=d.current,g=d.max,v=d.message;return{initialized:t&&u&&!f&&k.a.isNil(c)&&k.a.isNil(m),auth:{isSignedIn:r,signIn:a,signOut:i,profile:o,error:c},mail:{client:l,error:m},progress:{active:f,current:p,max:g,message:v}}}),xe)((function(e){var n,t,i=e.initialized,o=e.auth,c=o.isSignedIn,s=o.signIn,u=o.signOut,l=o.profile,m=l.name,d=l.imageUrl,f=o.error,p=e.mail,g=p.client,b=p.error,_=e.progress,O=_.current,x=_.max,w=_.message,y=e.onAuthInit,j=e.onAuthInitError,N=e.onSignedIn,C=e.onSignedOut,T=e.onMailInit,A=e.onMailInitError,R=e.activateProgress,z=e.deactivateProgress,B=Object(r.useState)([]),L=Object(I.a)(B,2),M=L[0],P=L[1],U=Object(r.useState)(Object(fe.a)()),H=Object(I.a)(U,2),G=H[0],F=H[1];S({clientId:"797091362316-t4kt893ttu0ls2gdbjhbq7pn7g2r22tq.apps.googleusercontent.com",hostedDomain:"jetbrains.com",scope:"https://www.googleapis.com/auth/gmail.readonly",onSignedIn:N,onSignedOut:C,onInitialized:y,onInitializationError:j}),oe({apiKey:"AIzaSyD-QsOK6xDB1oECO1uEX-PCzi-FeauYGSo",onInitialized:T,onInitializationError:A}),n=Object(h.a)(v.a.mark((function e(){var n,t,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===g||!c){e.next=30;break}return R({message:"Loading emails..."}),e.next=4,ue(g);case 4:return n=e.sent,R({message:"Found ".concat(n.length," emails in LFS mail list")}),e.next=8,Ee(n);case 8:return t=e.sent,console.log("New emails: ".concat(t.length)),R({message:"Fetching ".concat(t.length," new emails")}),e.next=13,se(g,t);case 13:return r=e.sent,e.next=16,ke(r);case 16:return console.log("Done saving"),R({message:"Processing messages"}),e.t0=P,e.next=21,Oe(n);case 21:return e.t1=e.sent,(0,e.t0)(e.t1),console.log("Done processing"),e.t2=F,e.next=27,be();case 27:e.t3=e.sent,(0,e.t2)(e.t3),z();case 30:case"end":return e.stop()}}),e)}))),t=[g,c],Object(r.useEffect)((function(){!function(){var e=Object(h.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),t);var Y=function(){var e=Object(h.a)(v.a.mark((function e(n){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=F,e.t1=fe.a,e.next=4,he(n);case 4:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),(0,e.t0)(e.t3);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),q=function(){var e=Object(h.a)(v.a.mark((function e(n){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=F,e.t1=fe.a,e.next=4,Ie(n);case 4:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),(0,e.t0)(e.t3);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return a.a.createElement(a.a.Fragment,null,a.a.createElement(D,{name:m,imageUrl:d,isSignedIn:c,signOut:u}),a.a.createElement("main",{className:E.a.mainContainer},i?c?a.a.createElement(ie,{messages:M,onMarkReadClicked:Y,onMarkUnreadClicked:q,readIds:G}):a.a.createElement(X,{onSignInClicked:s,disabled:!i}):a.a.createElement(K,{current:O,max:x,message:w,errors:k.a.compact([f,b])})))})),we=t(169),ye=t(170),je=t(173),Ne=t.n(je),Ce=Object(s.createStore)(p,Object(we.composeWithDevTools)());M.a.extend(Ne.a);var Te=function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(ye.a,null,a.a.createElement("title",null,"LFS errors dashboard")),a.a.createElement(c.a,{store:Ce},a.a.createElement(Se,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(Te,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},56:function(e,n,t){e.exports={header:"Header_header__3mObx",logoContainer:"Header_logoContainer__39AYI",logo:"Header_logo__2ins2",titleContainer:"Header_titleContainer__2q2gU",logoTitle:"Header_logoTitle__3xLCf"}},57:function(e,n,t){e.exports={buttonsContainer:"ErrorsTable_buttonsContainer__8kkG8",selectionCount:"ErrorsTable_selectionCount__nvLEX",unread:"ErrorsTable_unread__3MOKi"}},70:function(e,n,t){e.exports={container:"SignInSignOutBlock_container__2c2bM",userNameSpan:"SignInSignOutBlock_userNameSpan__3Fm_h",avatarContainer:"SignInSignOutBlock_avatarContainer__11L6Q",nameAndButtonContainer:"SignInSignOutBlock_nameAndButtonContainer__pxRSB"}},90:function(e,n,t){e.exports={container:"LoadingBanner_container__BeMk5",message:"LoadingBanner_message__2DQ7T",errorAlert:"LoadingBanner_errorAlert__3JNs6"}}},[[179,1,2]]]);
//# sourceMappingURL=main.664e6e51.chunk.js.map